### 基础篇

#### 使用场景

**问题：如何设计一个秒杀系统？**即如何利用有限的服务器资源，尽可能多地处理短时间内的海量请求

1. 异步处理

   **实现服务的异步处理**

   - 可以更快地返回结果
   - 减少等待，自然实现了步骤之间的并发，提升系统总体的性能

2. 流量削峰

   **如何避免过多的请求压垮我们的秒杀系统？**使用消息队列隔离网关和后端服务，以达到流量控制和保护后端服务的目的。

   加入消息队列后

   - 网关在收到请求后，将请求放入请求消息队列；

   - 后端服务从请求消息队列中获取 APP 请求，完成后续秒杀处理过程，然后返回结果。

     优点：能根据下游的处理能力自动调节流量，达到“削峰填谷”的作用

     缺点：增加了系统调用链环节，导致总体的响应时延变长；

     ​			上下游系统都要将同步调用改为异步消息，增加了系统的复杂度。

   加入令牌桶后

   ​	不需要破坏原有的调用链，只要网关在处理 APP 请求时增加一个获取令牌的逻辑。

   ​	令牌发生器按照预估的处理能力，匀速生产令牌并放入令牌队列（如果队列满了则丢弃令牌），网关在收到请求时去令牌队列消费一个令牌，获取到令牌则继续调用后端秒杀服务，如果获取不到令牌则直接返回秒杀失败。

3. 服务解耦

   通过主题订阅的方式

4. 其他

   - 作为发布 / 订阅系统实现一个微服务级系统间的观察者模式；

   - 连接流计算任务和数据；

   - 用于将消息广播给大量接收者。

     总结：在单体应用里面需要用队列解决的问题，在分布式系统中大多都可以用消息队列来解决

5. 消息队列的局限

   - 引入消息队列带来的延迟问题
   - 增加了系统的复杂度；
   - 可能产生数据不一致的问题。

#### 如何选择消息队列

- 选择消息队列产品的基本标准
  1. 开源
  2. 社区活跃
  3. 消息的可靠传递：确保不丢消息
  4. Cluster：支持集群，确保不会因为某个节点宕机导致服务不可用，当然也不能丢消息
  5. 性能：具备足够好的性能，能满足绝大多数场景的性能要求

- 可供选择的消息队列产品

  - RabbitMQ

    优势：

    - Erlang 语言编写的，它最早是为电信行业系统之间的可靠通信设计的，也是少数几个支持 AMQP 协议的消息队列之一,持非常灵活的路由配置,在生产者（Producer）和队列（Queue）之间增加了一个 Exchange 模块

    缺点：

    - RabbitMQ 对消息堆积的支持并不好，当大量消息积压的时候，会导致 RabbitMQ 的性能急剧下降
    - 依据硬件配置的不同，它大概每秒钟可以处理几万到十几万条消息，不过，如果你的应用对消息队列的性能要求非常高，那不要选择 RabbitMQ
    -  RabbitMQ 使用的编程语言 Erlang，这个编程语言不仅是非常小众的语言，更麻烦的是，这个语言的学习曲线非常陡峭

  - RocketMQ

    优势：

    - 有着不错的性能，稳定性和可靠性，具备一个现代的消息队列应该有的几乎全部功能和特性
    - 活跃的中文社区，使用 Java 语言开发
    - 对在线业务的响应时延做了很多的优化，大多数情况下可以做到毫秒级的响应
    - 每秒钟大概能处理几十万条消息

    缺点：

    - 作为国产的消息队列，相比国外的比较流行的同类产品，在国际上还没有那么流行，与周边生态系统的集成和兼容程度要略逊一筹

  - Kafka

    优势：

    - 早期为了处理海量的日志而设计，不保证消息的可靠性，可能会丢失消息，也不支持集群，功能上也比较简陋；随后的几年 Kafka 逐步补齐了这些短板
    - Kafka 与周边生态系统的兼容性是最好的没有之一，尤其在大数据和流计算领域，几乎所有的相关开源软件系统都会优先支持 Kafka。
    - Kafka 使用 Scala 和 Java 语言开发，设计上大量使用了批量和异步的思想，这种设计使得 Kafka 能做到超高的性能。Kafka 的性能，尤其是异步收发的性能，是三者中最好的

    缺点：

    - 同步收发消息的响应时延比较高，因为当客户端发送一条消息的时候，Kafka 并不会立即发送出去，而是要等一会儿攒一批再发送。当你的业务场景中，每秒钟消息数量没有那么多的时候，Kafka 的时延反而会比较高。所以，**Kafka 不太适合在线业务场景**

  - Pulsar

    - 采用存储和计算分离的设计（值得关注)

  #### 消息模型：主题和队列有什么区别

  它们最大的区别其实就是，一份消息数据能不能被消费多次的问题，实际上，在这种发布 - 订阅模型中，如果只有一个订阅者，那它和队列模型就基本是一样的了。也就是说，发布 - 订阅模型在功能层面上是可以兼容队列模型的

  - RabbitMQ

    在 RabbitMQ 中，Exchange 位于生产者和队列之间，生产者并不关心将消息发送给哪个队列，而是将消息发送给 Exchange，由 Exchange 上配置的策略来决定将消息投递到哪些队列中。

  - RocketMQ

    **待完成**

  - Kafka

    **待完成**

  #### 如何利用事务消息实现分布式事务

  **消息队列中的“事务”，主要解决的是消息生产者和消息消费者的数据一致性问题。**



进度----- 20

