**并发问题产生的原因**

随着CPU、内存、I/O设备的更新，一直存在着一个**核心矛盾**：**三者的速度差异**。而根据木桶理论（一只水桶能装多少水取决于它最短的那块木板），即取决于I/O设备。

为了合理利用CPU的高性能，平衡这三者的速度差异，计算机体系结构、操作系统、编译程序都做出了贡献，主要体现为：

1. CPU 增加了缓存，以均衡与内存的速度差异；
2. 操作系统增加了进程、线程，以分时复用 CPU，进而均衡 CPU 与 I/O 设备的速度差异；
3. 编译程序优化指令执行次序，使得缓存能够得到更加合理地利用。

但这也给并发带来了新的问题，可归结为：**可见性问题**、**原子性问题**、**有序性问题**

**缓存导致的可见性问题**

> 可见性：一个线程对共享变量的修改，另外一个线程能够立刻看到

![多核CPU的缓存与内存关系图](F:\github\super-java\picture\多核CPU的缓存与内存关系图.webp)

1. 线程A和B同时开始运行，线程A执行V+1，此时并未写入内存
2. 线程B开始执行，读取到V=0，此时**线程A执行后的V对B不可见**，然后执行V+1
3. 两个线程都将V=1写入内存，与期待的结果2并不同

**线程切换导致的原子性问题**

待补充...

**编译优化导致的有序性问题**

待补充...

缓存、线程、编译优化都是为了提高程序性能，但同时又带来了新的问题。由此，我们**在采用一项技术的同时，一定要清楚它带来的问题是什么，以及如何规避**。
